google.charts.load("current",{packages:["corechart","bar","gauge","scatter"]});var wpDataTablesGoogleChart=function(){var a={rows:[],columns:[],type:"column",containerId:"googleChartContainer",columnIndexes:[],connectedWPDataTable:null,chart:null,googleDataTable:null,renderCallback:null,options:{animation:{duration:1e3,easing:"out",startup:!0},backgroundColor:{fill:"#FFFFFF",strokeWidth:0,stroke:"#666",rx:0},chartArea:{backgroundColor:{}},crosshair:{},curveType:"none",fontName:"Arial",fontSize:null,hAxis:{direction:1},height:400,legend:{position:"right"},orientation:"horizontal",titlePosition:"out",tooltip:{trigger:"focus"},vAxis:{direction:1,viewWindow:{}}},setRows:function(a){this.rows=a},enableDateTimeAxis:function(){this.options.hAxis.gridlines={count:-1,units:{days:{format:["MMM dd"]},hours:{format:["HH:mm","ha"]}}}},detectDates:function(){for(var a in this.columns)if("date"==this.columns[a].type||"datetime"==this.columns[a].type)for(var b in this.rows){var c=Date.parse(this.rows[b][a]);if(isNaN(c))this.rows[b][a]=new Date;else if(this.rows[b][a]=new Date(c),null==this.connectedWPDataTable){var d=this.rows[b][a].getTime();"datetime"==this.columns[a].type&&(d+=60*this.rows[b][a].getTimezoneOffset()*1e3),this.rows[b][a].setTime(d)}else this.rows[b][a].setTime(this.rows[b][a].getTime());"datetime"==this.columns[a].type&&this.enableDateTimeAxis()}},setColumns:function(a){this.columns=a},getColumns:function(){return this.columns},setOptions:function(b){for(var c in b)"responsive_width"!=c||"1"!=b[c]?this.options[c]=b[c]:(a.options.animation=!1,jQuery(window).resize(function(){a.chart.draw(a.googleDataTable,a.options)}))},getOptions:function(){return this.options},setType:function(a){this.type=a},getType:function(){return this.type},setGrouping:function(a){this.group_chart=a},setContainer:function(a){this.containerId=a},getContainer:function(){return this.containerId},setRenderCallback:function(a){this.renderCallback=a},render:function(){this.googleDataTable=new google.visualization.DataTable;for(var a in this.columns)this.googleDataTable.addColumn(this.columns[a]);switch(this.detectDates(),this.googleDataTable.addRows(this.rows),this.type){case"google_column_chart":this.chart=new google.visualization.ColumnChart(document.getElementById(this.containerId));break;case"google_histogram":this.chart=new google.visualization.Histogram(document.getElementById(this.containerId));break;case"google_bar_chart":this.options.orientation="vertical",this.chart=new google.visualization.BarChart(document.getElementById(this.containerId));break;case"google_area_chart":this.chart=new google.visualization.AreaChart(document.getElementById(this.containerId));break;case"google_stepped_area_chart":this.options.isStacked=!0,this.chart=new google.visualization.SteppedAreaChart(document.getElementById(this.containerId));break;case"google_line_chart":this.chart=new google.visualization.LineChart(document.getElementById(this.containerId));break;case"google_pie_chart":this.chart=new google.visualization.PieChart(document.getElementById(this.containerId));break;case"google_bubble_chart":this.chart=new google.visualization.BubbleChart(document.getElementById(this.containerId));break;case"google_donut_chart":this.options.pieHole=.4,this.chart=new google.visualization.PieChart(document.getElementById(this.containerId));break;case"google_gauge_chart":this.options.redFrom=90,this.options.redTo=100,this.options.yellowFrom=75,this.options.yellowTo=90,this.options.minorTicks=5,this.chart=new google.visualization.Gauge(document.getElementById(this.containerId));break;case"google_scatter_chart":this.chart=new google.visualization.ScatterChart(document.getElementById(this.containerId));break;case"google_candlestick_chart":this.chart=new google.visualization.CandlestickChart(document.getElementById(this.containerId))}null!==this.renderCallback&&this.renderCallback(this),this.chart.draw(this.googleDataTable,this.options)},refresh:function(){if("undefined"!=typeof google.visualization.DataTable&&null!=this.chart){this.googleDataTable=new google.visualization.DataTable;for(var a in this.columns)this.googleDataTable.addColumn(this.columns[a]);this.detectDates(),this.googleDataTable.addRows(this.rows),null!==this.renderCallback&&this.renderCallback(this),this.chart.draw(this.googleDataTable,this.options)}},setConnectedWPDataTable:function(a){this.connectedWPDataTable=a},getConnectedWPDataTable:function(){return this.connectedWPDataTable},setChartConfig:function(b){1==b.responsive_width?(this.options.animation=!1,delete this.options.width,jQuery(window).resize(function(){a.chart.draw(a.googleDataTable,a.options)})):this.options.width=b.width,b.height?this.options.height=b.height:null,this.options.backgroundColor.fill=b.background_color,b.border_width?this.options.backgroundColor.strokeWidth=b.border_width:null,this.options.backgroundColor.stroke=b.border_color,b.border_radius?this.options.backgroundColor.rx=b.border_radius:null,b.border_radius?this.options.backgroundColor.rx=b.border_radius:null,this.options.chartArea.backgroundColor.fill=b.plot_background_color,b.plot_border_width?this.options.chartArea.backgroundColor.strokeWidth=b.plot_border_width:null,this.options.chartArea.backgroundColor.stroke=b.plot_border_color,b.font_size?this.options.fontSize=b.font_size:null,b.font_name?this.options.fontName=b.font_name:null,"google_pie_chart"==b.chart_type&&(1==b.three_d?this.options.is3D=!0:this.options.is3D=!1);var c=0;for(var d in b.series_data)this.columns[c+1].label=b.series_data[d].label,""!=b.series_data[d].color&&(this.options.series[c]={color:b.series_data[d].color}),c++;"google_line_chart"==b.chart_type&&(1==b.curve_type?this.options.curveType="function":this.options.curveType="none"),0==b.show_grid?(this.options.hAxis.gridlines={color:"transparent"},this.options.vAxis.gridlines={color:"transparent"}):(delete this.options.hAxis.gridlines,delete this.options.vAxis.gridlines),b.horizontal_axis_label?this.options.hAxis.title=b.horizontal_axis_label:null,1==b.horizontal_axis_crosshair&&0==b.vertical_axis_crosshair?this.options.crosshair={trigger:"both",orientation:"horizontal"}:0==b.horizontal_axis_crosshair&&1==b.vertical_axis_crosshair?this.options.crosshair={trigger:"both",orientation:"vertical"}:1==b.horizontal_axis_crosshair&&1==b.vertical_axis_crosshair?this.options.crosshair={trigger:"both",orientation:"both"}:this.options.crosshair={},b.horizontal_axis_direction?this.options.hAxis.direction=b.horizontal_axis_direction:null,b.vertical_axis_label?this.options.vAxis.title=b.vertical_axis_label:null,b.vertical_axis_direction?this.options.vAxis.direction=b.vertical_axis_direction:null,b.vertical_axis_min?this.options.vAxis.viewWindow.min=b.vertical_axis_min:null,b.vertical_axis_max?this.options.vAxis.viewWindow.max=b.vertical_axis_max:null,1==b.inverted?this.options.orientation="vertical":this.options.orientation="horizontal",1==b.show_title?this.options.title=b.chart_title:this.options.title="",1==b.title_floating?this.options.titlePosition="in":this.options.titlePosition="out",1==b.tooltip_enabled?this.options.tooltip.trigger="focus":this.options.tooltip.trigger="none",b.legend_position?this.options.legend.position=b.legend_position:null,"bottom"==b.legend_vertical_align?this.options.legend.alignment="end":"middle"==b.legend_vertical_align?this.options.legend.alignment="center":this.options.legend.alignment="start"},enableFollowFiltering:function(){null!=this.connectedWPDataTable&&this.connectedWPDataTable.fnSettings().aoDrawCallback.push({sName:"chart_filter_follow",fn:function(b){var c=[];a.options.animation=!1;var d=a.connectedWPDataTable._("tr",{filter:"applied"}).toArray(),e=jQuery.parseJSON(jQuery("#"+a.connectedWPDataTable.data("described-by")).val()).datepickFormat,f=e.replace(/dd/,"DD").replace(/Y/g,"YYYY").replace(/y/g,"YY").replace(/M/g,"mmm").replace(/mm/g,"MM");f+=" "+jQuery.parseJSON(jQuery("#"+a.connectedWPDataTable.data("described-by")).val()).timeFormat.replace("i","mm");var g=jQuery.parseJSON(jQuery("#"+a.connectedWPDataTable.data("described-by")).val()).number_format;for(var h in d){var i=[];for(var j in a.columnIndexes)if("number"==a.columns[j].type){var k=d[h][a.columnIndexes[j]];if(isNaN(k)){if(1==g)var l=".",m=",";else var l=",",m=".";k=wdtUnformatNumber(k,l,m,!0)}i.push(parseFloat(k))}else"date"==a.columns[j].type?i.push(jQuery.datepicker.parseDate(e,d[h][a.columnIndexes[j]])):"datetime"==a.columns[j].type?(i.push(moment(d[h][a.columnIndexes[j]],f).toDate()),a.enableDateTimeAxis()):i.push(d[h][a.columnIndexes[j]]);c.push(i)}if(1==a.group_chart){var n=[];for(var h in c)if("undefined"!=typeof n&&n.length>0){var o="none";for(var j in n)"none"===o&&n[j][0]==c[h][0]&&(o=j);if("none"===o)n.push(c[h]);else for(var p in c[h])0!=p&&(n[o][p]+=c[h][p])}else n.push(c[h]);c=n}a.rows=c,a.refresh()}})},setColumnIndexes:function(a){this.columnIndexes=a},getColumnIndexes:function(){return this.columnIndexes}};return a};